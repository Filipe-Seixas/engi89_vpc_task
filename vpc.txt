VPC > VPC (see all regions) > Ireland >
Create VPC
	name eng89_filipe_vpc
	Private network 10.102.0.0/16   255.255.0.0
	rest default
	create vpc
Internet Gateway
Create internet gateway
	name eng89_filipe_ig
Internet Gateway > Actions > attach to VPC
	Attach to eng89_filipe_vpc
Subnet
Create subnet
	Select vpc to attach it eng89_filipe_ig
	name eng89_filipe_subnet_public
	availability zone 1a
	CIDR block 10.102.1.0/24
	ADD NEW SUBNET
	name eng89_filipe_subnet_private
	availability zone 1a
	CIDR block 10.102.2.0/24
click on public subnet > route table 
	It already has a destination which is the VPC network
	Now we want to create a routing to allow subnets to communicate
Route table > create route table
	name eng89_filipe_route_internet
	vpc eng89_filipe_vpc
Edit Routes
	Add route 
		0.0.0.0/0 (Everything, anywhere)
		Target ig we created
subnet > select public subnet > route table > edit route table association > default route table change to eng89_filipe_route_internet

security group is connected to ec2, it's the firewall, used to allow and deny access to ports, we want to protect the instance
network acl is for whole network

Security Groups > create security group
	name eng89_filipe_app (for the public subnet)
	vpc eng89_filipe_vpc
	Inbound rules - who can access the instance, control what's coming in
		add rule
			HTTP Anywhere ipv4
			SSH My ip
	Outbound rules - What the instance can access, control what's going out
		

for db > inbound rule > custom tcp -27017 -custom -app

stateful firewall - port open in one direction and the firewall will remember to allow the response to pass in the opposite direction
SG are stateful
ACLs are stateless

NETWORK ACLs > create new
	eng89_filipe_nacl_public
	eng89_filipe_vpc
eng89_filipe_nacl_public > Edit inbound rules
	100 - HTTP - 0.0.0.0/0
	110 - SSH - ip addr/32
	120 - Custom tcp - 1024-65535 - 0.0.0.0/0

eng89_filipe_nacl_public > Edit outbound rules
	100 - HTTP - 0.0.0.0/0
	110 - Custom TCP - 27017 - 10.102.2.0/24
	120 custom - 1024-65535 - 
> sunet association > add eng89_filipe_nacl_public to public subnet
The network ACL checks all rules, if it gets to the end and doesn't get a match, it denies it

NETWORK ACLs > create new
eng89_filipe_nacl_private
	eng89_filipe_vpc
eng89_filipe_nacl_private > Edit inbound rules
	100 - HTTP - 0.0.0.0/0
	110 - Custom TCP - 1024-65535 0.0.0.0/0

eng89_filipe_nacl_private > Edit outbound rules
	100 - HTTP - 0.0.0.0/0
	110 - Custom TCP - 1024-65535 0.0.0.0/0
	120 custom - 1024-65535 - 
> sunet association > add eng89_filipe_nacl_private to private subnet


Create new instance> Amazon Linux
	This is our public app
	Network: our vpc
	Subnet: our public subnet
	Auto-assign Public IP: Enable
	> Add a name tag
	> Use our app security group
	> Choose key eng89_devops
	
Create new instance> Amazon Linux
	This is our private db
	Network: our vpc
	Subnet: our private subnet
	Auto-assign Public IP: Disable
	> Add a name tag
	> Use our db security group
	> Choose key eng89_devops

subnet > create subnet 
	name eng89_filipe_subnet_bastion
	availability zone 1a
	CIDR block 10.102.3.0/24
click on public subnet > route table 
	Add Internet gateway

Security Groups > create security group
	name eng89_filipe_bastion
	vpc eng89_filipe_vpc
	Inbound rules - who can access the instance, control what's coming in
		add rule
			SSH My ip
	Outbound rules - What the instance can access, control what's going out
		- Add allow all traffic

NETWORK ACLs > create new
	eng89_filipe_nacl_bastion
	eng89_filipe_vpc
eng89_filipe_nacl_bastion > Edit inbound rules
	100 - SSH - ip addr/32
	120 - Custom tcp - 1024-65535 - 10.102.2.0/24 (db ip)

eng89_filipe_nacl_bastion > Edit outbound rules
	100 - SSH - 10.102.2.0/24 (db ip)
	110 - Custom TCP - 27017 - My IP
> subnet association > add eng89_filipe_nacl_bastion to bastion subnet

Copy key into bastion server
scp -i eng89_devops.pem eng89_devops.pem ubuntu@34.243.76.17:~/
Move key to .ssh folder
mv eng89_devops.pem .ssh/
cd .ssh/
chmod 400 eng89_devops.pem
ssh -i "eng89_devops.pem" ubuntu@10.102.2.27 

naming eng89_infra_filipe...
use 10.202 for ip

